<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>교수님 상세</title>
    <link rel="stylesheet" href="./style.css" />
    <style>
      .tmi-wrap {
        max-width: 560px;
        margin: 10 auto;
      }
      .tmi-header {
        color: #7f4ca5;
        text-align: center;
        margin-bottom: 14px;
      }
      .tmi-grid {
        display: grid;
        grid-template-columns: max-content max-content;
        gap: 8px 40px;
        justify-content: center;
        text-align: center;
        margin-top: 24px;
        margin-bottom: 30px;
      }
      .tmi-label {
        color: #7f4ca5;
        text-align: center;
        padding-right: 8px;
      }
      .tmi-value {
        /* color:#d6a8c4;  */
        font-weight: 600;
      }
      .subtle {
        color: #6b7280;
        font-size: 0.95rem;
      }
      .compare {
        margin-top: 14px;
        border-top: 1px solid #e5e7eb;
        padding-top: 12px;
      }
      .pill {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        background: #f3f4f6;
        margin: 2px;
      }
    </style>
  </head>
  <body>
    <section class="quiz-container tmi-wrap">
      <div class="tmi-header">
        <img id="profImg" alt="" class="center-img" />
        <h2 id="profName" class="result-title" style="margin-top: 8px"></h2>
        <div id="profMbti" class="subtle"></div>
      </div>

      <h3 style="margin: 6px 0 8px">교수님 정보</h3>
      <div class="tmi-grid" id="tmiGrid">
        <!-- JS로 채움 -->
      </div>

      <div class="compare" id="compareBox" style="display: none">
        <h4 style="margin: 0 0 8px">내 답변과 비교</h4>
        <div id="myName" class="subtle"></div>
        <div style="margin-top: 6px" id="myPrefs"></div>
      </div>

      <div style="text-align: center; margin-top: 16px">
        <a class="btn-primary" href="./index.html">테스트 다시 하기</a>
      </div>
    </section>
    <script src="./professors.js"></script>
    <script>
      const professors = window.professors;

      // (2) 쿼리스트링에서 교수 이름 읽기
      const params = new URLSearchParams(location.search);
      const profName = params.get("prof") || "";
      const prof = professors.find((p) => p.name === profName);

      const profNameEl = document.getElementById("profName");
      const profImgEl = document.getElementById("profImg");
      const profMbtiEl = document.getElementById("profMbti");
      const gridEl = document.getElementById("tmiGrid");

      function safe(v) {
        return v && String(v).trim() ? v : "정보 준비중";
      }

      if (!prof) {
        profNameEl.textContent = "교수 정보를 찾을 수 없어요";
      } else {
        profNameEl.textContent = `${prof.name} 교수님`;
        profImgEl.src = prof.image;
        profImgEl.alt = `${prof.name} 교수님 사진`;

        const labels = {
          mbti: "MBTI",
          lang: "최애 언어",
          food: "좋아하는 음식",
          classTime: "선호 수업 시간",
          classType: "수업 형태",
          estimateType: "평가 방식",
          schedule: "더 힘든 일정",
          travel: "여행지",
          os: "선호 OS",
          exam: "시험 유형",
        };
        Object.keys(labels).forEach((key) => {
          const rowLabel = document.createElement("div");
          rowLabel.className = "tmi-label";
          rowLabel.textContent = labels[key];

          const rowVal = document.createElement("div");
          rowVal.className = "tmi-value";
          rowVal.textContent = safe(prof.prefs[key]);

          gridEl.appendChild(rowLabel);
          gridEl.appendChild(rowVal);
        });
      }

      // (3) 내 최근 결과와 비교 (로컬스토리지)
      const last = JSON.parse(localStorage.getItem("lastResult") || "null");
      if (last) {
        const box = document.getElementById("compareBox");
        box.style.display = "block";
        document.getElementById("myName").textContent = `${
          last.userName
        }님의 MBTI: ${last.userMBTI || "—"}`;

        const mapLabels = {
          lang: "최애 언어",
          food: "음식",
          classTime: "수업 시간",
          classType: "수업 형태",
          estimateType: "평가",
          schedule: "일정",
          travel: "여행지",
          os: "OS",
          exam: "시험 유형",
        };
        const wrap = document.getElementById("myPrefs");
        wrap.innerHTML = "";
        Object.keys(mapLabels).forEach((k) => {
          const val = last.userPrefs?.[k] || "—";
          const chip = document.createElement("span");
          chip.className = "pill";
          chip.textContent = `${mapLabels[k]}: ${val}`;
          wrap.appendChild(chip);
        });
      }
    </script>
  </body>
</html>
